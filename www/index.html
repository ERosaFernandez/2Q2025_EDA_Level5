<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>EDAoogle</title>
    <link rel="preload" href="https://fonts.googleapis.com" />
    <link rel="preload" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
    <link rel="preload" href="css/style.css" />
    <link rel="stylesheet" href="css/style.css" />
    <style>
        .search {
            position: relative;
        }

        #suggestions {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            width: min(90vw, 500px);
            top: 100%;
            left: 0;
            margin-top: 4px;
        }

        .suggestion-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }

            .suggestion-item:last-child {
                border-bottom: none;
            }

            .suggestion-item:hover {
                background-color: #f5f5f5;
            }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const input = document.querySelector('input[name="q"]');
            const form = document.querySelector('form');
            const searchContainer = document.querySelector('.search');
            let suggestionsDiv = document.createElement('div');
            suggestionsDiv.id = 'suggestions';
            searchContainer.appendChild(suggestionsDiv);

            let debounceTimer;

            input.addEventListener('input', (e) => {
                clearTimeout(debounceTimer);

                const fullQuery = e.target.value;
                const words = fullQuery.split(' ');
                const lastWord = words[words.length - 1].trim();

                if (lastWord.length < 2) {
                    suggestionsDiv.style.display = 'none';
                    return;
                }

                debounceTimer = setTimeout(async () => {
                    try {
                        const response = await fetch('/predict?q=' + encodeURIComponent(lastWord));
                        const suggestions = await response.json();

                        if (suggestions.length > 0) {
                            suggestionsDiv.innerHTML = '';
                            suggestions.forEach(suggestion => {
                                const div = document.createElement('div');
                                div.className = 'suggestion-item';
                                div.textContent = suggestion;
                                div.onclick = () => {
                                    words[words.length - 1] = suggestion;
                                    input.value = words.join(' ') + ' ';
                                    suggestionsDiv.style.display = 'none';
                                    input.focus();
                                };
                                suggestionsDiv.appendChild(div);
                            });
                            suggestionsDiv.style.display = 'block';
                        } else {
                            suggestionsDiv.style.display = 'none';
                        }
                    } catch (error) {
                        console.error('Error fetching suggestions:', error);
                    }
                }, 300);
            });

            document.addEventListener('click', (e) => {
                if (e.target !== input && !suggestionsDiv.contains(e.target)) {
                    suggestionsDiv.style.display = 'none';
                }
            });
        });
    </script>
</head>

<body>
    <article class="edaoogle">
        <div class="title">EDAoogle</div>
        <div class="search">
            <form action="/search" method="get">
                <input type="text" name="q" autofocus>
                <button type="submit" class="search-btn">Buscar</button>
            </form>
        </div>
    </article>
</body>

</html>